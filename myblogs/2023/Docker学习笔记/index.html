<html>
<head>
	
	<title>Docker学习笔记</title>
	<meta name="keywords" content="Acheron,blog,博客,代码,技术,书法,读书" />

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    

        
<link rel="stylesheet" href="/css/bootstrap.min.css">

        
<link rel="stylesheet" href="/css/bootstrap-theme.min.css">



	   <link href="/css/main.css?v=3" rel="stylesheet" type="text/css" />
    
        
<script src="/js/util.js"></script>

        <script>
            if(isMobile()) {
                loadjscssfile('../css/mobile.css', 'css');
            } else {
                loadjscssfile('../css/desktop.css', 'css');
            }
        </script> 
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=3"/>
    
    

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
<nav class="navbar navbar-inverse navbar-fixed-top" style="opacity: .9" role="navigation">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">HeroHuang&#39;s Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav nav-tabs navbar-right">
            
                
                    <li >
                        <a href="/"> 首页</a>
                    </li>
                
                    <li >
                        <a href="/myblogs/read"> 读书</a>
                    </li>
                
                    <li >
                        <a href="/myblogs/shufa"> 书法</a>
                    </li>
                
                    <li >
                        <a href="/myblogs/code"> 代码</a>
                    </li>
                
                    <li >
                        <a href="/myblogs/life"> 生活</a>
                    </li>
                
                    <li >
                        <a href="/myblogs/about"> 我是</a>
                    </li>
                
            
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>


<br/>


<h2 class="title">Docker学习笔记</h2>

<div style="text-align:center;margin-top: -10px;">
<div class="article-category" style="text-align:right;">

2023年3月10日




<!--  -->
 </div>

</div>

<!-- <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker%E6%A6%82%E8%BF%B0"><span class="toc-text">Docker概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E6%9E%B6%E6%9E%84"><span class="toc-text">Docker架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-text">几个重要的概念</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8get-started%E5%BA%94%E7%94%A8%E6%9D%A5%E5%AD%A6%E4%B9%A0docker%E7%9A%84%E5%90%84%E4%B8%AA%E5%8A%9F%E8%83%BD"><span class="toc-text">用get started应用来学习docker的各个功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8-container-image%E6%AD%A5%E9%AA%A4%E7%A4%BA%E4%BE%8B"><span class="toc-text">构建一个应用 container image步骤示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%BA%86%E4%BB%A3%E7%A0%81%E5%90%8E%E9%87%8D%E6%96%B0%E6%9B%B4%E6%96%B0"><span class="toc-text">修改了代码后重新更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96%E6%95%B0%E6%8D%AE"><span class="toc-text">持久化数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#container%E4%B9%8B%E9%97%B4%E9%80%9A%E8%BF%87network%E4%BA%A4%E4%BA%92"><span class="toc-text">container之间通过network交互</span></a></li></ol></li></ol> -->
<p>之前对docker只是简单的使用，没有系统的学过，这次把docker官网的文档仔仔细细都读了一遍，这里对一些个人觉得比较重要的一些内容，做一些记录和总结。</p>
<p><a href="https://docs.docker.com/get-started/overview/">Docker官网文档</a></p>
<h2 id="Docker概述"><a href="#Docker概述" class="headerlink" title="Docker概述"></a>Docker概述</h2><p>Docker uses a client-server architecture. The Docker client talks to the Docker daemon, which does the heavy lifting of building, running, and distributing your Docker containers. The Docker client and daemon can run on the same system, or you can connect a Docker client to a remote Docker daemon. The Docker client and daemon communicate using a REST API, over UNIX sockets or a network interface. Another Docker client is Docker Compose, that lets you work with applications consisting of a set of containers.</p>
<h3 id="Docker架构"><a href="#Docker架构" class="headerlink" title="Docker架构"></a>Docker架构</h3><p>最新的文档发现已经不是这张图了，画的好看点了。<br>!(docker-architecture)[images&#x2F;docker-architecture.jpg]</p>
<h3 id="几个重要的概念"><a href="#几个重要的概念" class="headerlink" title="几个重要的概念"></a>几个重要的概念</h3><p>The Docker daemon<br>The Docker daemon (dockerd) listens for Docker API requests and manages Docker objects such as images, containers, networks, and volumes.</p>
<p>The Docker client<br>The Docker client (docker) is the primary way that many Docker users interact with Docker. When you use commands such as docker run, the client sends these commands to dockerd, which carries them out. </p>
<p>Images<br>An image is a read-only template with instructions for creating a Docker container.</p>
<p>Containers<br>A container is a runnable instance of an image. You can create, start, stop, move, or delete a container using the Docker API or CLI. </p>
<h2 id="用get-started应用来学习docker的各个功能"><a href="#用get-started应用来学习docker的各个功能" class="headerlink" title="用get started应用来学习docker的各个功能"></a>用get started应用来学习docker的各个功能</h2><h3 id="构建一个应用-container-image步骤示例"><a href="#构建一个应用-container-image步骤示例" class="headerlink" title="构建一个应用 container image步骤示例"></a>构建一个应用 container image步骤示例</h3><ol>
<li><p>获取一个示例：git clone <a href="https://github.com/docker/getting-started.git">https://github.com/docker/getting-started.git</a></p>
</li>
<li><p>进入app目录 cd getting-started&#x2F;app</p>
</li>
<li><p>在app目录下创建一个Dockerfile文件<br>Dockerfile的作用：A Dockerfile contains a script of instructions that Docker uses to create a container image.</p>
</li>
<li><p>在Dockerfile里写入以下内容</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># syntax=docker/dockerfile:1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">18</span>-alpine</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yarn install --production</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;node&quot;</span>, <span class="string">&quot;src/index.js&quot;</span>]</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>
<p>5.在app目录执行命令：docker build -t getting-started .<br>命令解释：<br>the -t :tags your image, as a human-readable name for the final image.<br>The . :tells Docker that it should look for the Dockerfile in the current directory.</p>
</li>
<li><p>启动刚创建的image：docker run -dp 3000:3000 getting-started<br>-d :to run the new container in “detached” mode (in the background).<br>-p :to create a mapping between the host’s port 3000 to the container’s port 3000.</p>
</li>
<li><p>启动成功后访问：<a href="http://localhost:3000/">http://localhost:3000</a></p>
</li>
</ol>
<h3 id="修改了代码后重新更新"><a href="#修改了代码后重新更新" class="headerlink" title="修改了代码后重新更新"></a>修改了代码后重新更新</h3><ol start="8">
<li>查看运行的container可以看到container-id：docker ps</li>
<li>停止container：docker stop <container-id></li>
<li>删除：docker rm <the-container-id></li>
<li>更新源码重新构建，比如我们修改app&#x2F;src&#x2F;static&#x2F;js&#x2F;app.js 56行的显示文字<br>修改后再次执行第5步 和第6步 命令<br>docker build -t getting-started .<br>docker run -dp 3000:3000 getting-started<br>启动后重新访问，会发现显示文字是修改后的了。</li>
</ol>
<h3 id="持久化数据"><a href="#持久化数据" class="headerlink" title="持久化数据"></a>持久化数据</h3><blockquote>
<p>volume mounts方式:</p>
</blockquote>
<p>每次重启getting-started，页面上我们添加的item都会消失，因为 Each container gets its own space. Any changes won’t be seen in another container, even if they are using the same image。<br>12. 创建一个volume：docker volume create todo-db<br>13. 继续启动getting-started<br>    docker run -dp 3000:3000 –mount type&#x3D;volume,src&#x3D;todo-db,target&#x3D;&#x2F;etc&#x2F;todos getting-started<br>    参数说明：<br>    –mount option to specify a volume mount. We will give the volume a name,<br>    and mount it to &#x2F;etc&#x2F;todos in the container, which will capture all files created at the path.<br>14. 访问<a href="http://localhost:3000，页面上随便新增几个new">http://localhost:3000，页面上随便新增几个new</a> item<br>15. 然后删除这个container：docker rm -f <id> ，在重新运行13步启动一个新的container，访问页面发现我们添加的item数据还在。<br>16. 查看数据被存在哪里，运行命令能看到Mountpoint就是数据被存于硬盘上的真实位置：docker volume inspect todo-db</p>
<blockquote>
<p>bind mounts方式：（共享我们本地机器和container之间的数据）<br>17. 还是在getting-started&#x2F;app目录执行下面命令</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -dp 3000:3000 \</span><br><span class="line">    -w /app --mount type=bind,src=&quot;$(pwd)&quot;,target=/app \</span><br><span class="line">    node:18-alpine \</span><br><span class="line">    sh -c &quot;yarn install &amp;&amp; yarn run dev&quot;</span><br></pre></td></tr></table></figure>
<p>参数解释：（参数越来越多了，接下来将会介绍 Docker Compose ）<br>-dp 3000:3000 - same as before. Run in detached (background) mode and create a port mapping<br>-w &#x2F;app - sets the “working directory” or the current directory that the command will run from<br>–mount type&#x3D;bind,src&#x3D;”$(pwd)”,target&#x3D;&#x2F;app - bind mount the current directory from the host into the &#x2F;app directory in the container<br>node:18-alpine - the image to use. Note that this is the base image for our app from the Dockerfile<br>sh -c “yarn install &amp;&amp; yarn run dev” - the command. </p>
<p>可以用docker logs -f <container-id> 查看上述执行日志<br>18. 执行完我们修改src&#x2F;static&#x2F;js&#x2F;app.js，56行的显示文字，刷新页面发现页面也变化了。说明host机器上的修改同步到了container上。<br>    这样改动后可以直接运行第5步docker build -t getting-started .构建自己的image。</p>
<h3 id="container之间通过network交互"><a href="#container之间通过network交互" class="headerlink" title="container之间通过network交互"></a>container之间通过network交互</h3><ol start="19">
<li>创建network：docker network create todo-app</li>
<li>启动一个mysql 链接上刚环境的network<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">     --network todo-app --network-alias mysql \</span><br><span class="line">     -v todo-mysql-data:/var/lib/mysql \</span><br><span class="line">     -e MYSQL_ROOT_PASSWORD=secret \</span><br><span class="line">     -e MYSQL_DATABASE=todos \</span><br><span class="line">     mysql:8.0</span><br><span class="line">```     </span><br><span class="line"></span><br><span class="line">&gt; Tip:You’ll notice a volume named todo-mysql-data in the above command that is mounted at /var/lib/mysql, which is where MySQL stores its data. However, you never ran a docker volume create command. Docker recognizes you want to use a named volume and creates one automatically for you.</span><br><span class="line"></span><br><span class="line">21. 启动成功后进入mysql：docker exec -it &lt;mysql-container-id&gt; mysql -u root -p</span><br><span class="line">    输入上述的密码：secret</span><br><span class="line">    </span><br><span class="line">22. 成功后可以看到刚创建的todos库：SHOW DATABASES;</span><br><span class="line"></span><br><span class="line">23. 现在其他container怎么链接刚启动的mysql。（ Remember that each container has its own IP address.)</span><br><span class="line">    用到：[https://github.com/nicolaka/netshoot](nicolaka/netshoot) , which ships with a lot of tools that are useful for troubleshooting or debugging networking issues.</span><br><span class="line">    用nicolaka/netshoot image 启动一个新container， Make sure to connect it to the same network：</span><br><span class="line">    docker run -it --network todo-app nicolaka/netshoot</span><br><span class="line">    </span><br><span class="line">24. 看ip，运行下面命令有一个ANSWER SECTION能看到ip：dig mysql</span><br><span class="line">    在20命令中，有一个--network-alias参数，What this means is that your app only simply needs to connect to a host named mysql and it’ll talk to the database.</span><br><span class="line"></span><br><span class="line">25. 现在启动app应用去连接mysql:</span><br></pre></td></tr></table></figure>
docker run -dp 3000:3000 <br>   -w &#x2F;app -v “$(pwd):&#x2F;app” <br>   –network todo-app <br>   -e MYSQL_HOST&#x3D;mysql <br>   -e MYSQL_USER&#x3D;root <br>   -e MYSQL_PASSWORD&#x3D;secret <br>   -e MYSQL_DB&#x3D;todos <br>   node:18-alpine <br>   sh -c “yarn install &amp;&amp; yarn run dev”<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行docker logs -f &lt;container-id&gt;，能看到连接mysql的信息</span><br><span class="line">26. 在页面上添加几个item，然后进入mysql的todos库：docker exec -it &lt;mysql-container-id&gt; mysql -p todos</span><br><span class="line">27. 运行sql，查看你添加的记录有没有存到表里：</span><br></pre></td></tr></table></figure>
mysql&gt; select * from todo_items;<br> +————————————–+——————–+———–+<br> | id                                   | name               | completed |<br> +————————————–+——————–+———–+<br> | c906ff08-60e6-44e6-8f49-ed56a0853e85 | haha1             |         0 |<br> | 2912a79e-8486-4bc3-a4c5-460793a575ab | haha2             |         0 |<br> +————————————–+——————–+———–+</li>
</ol>
<pre><code>

## Docker Compose的使用

Docker compose的最大好处:
&gt; The big advantage of using Compose is you can define your application stack in a file, keep it at the root of your project repo (it’s now version controlled), and easily enable someone else to contribute to your project. Someone would only need to clone your repo and start the compose app. I
















## 静态稳定linux版下载地址
https://download.docker.com/linux/static/stable/x86_64/





## docker安装ubuntu
docker run -i -t ubuntu /bin/bash

</code></pre>


<!--<a href="http://ac-heron.github.io/myblogs/2023/Docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#disqus_thread" class="article-comment-link">Comments</a>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = ''; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
-->
<div style="display:none">
<script src="http://s4.cnzz.com/stat.php?id=&web_id=" language="JavaScript"></script>script>
</div>




<script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
<!-- <script src="http://apps.bdimg.com/libs/bootstrap/3.3.0/js/bootstrap.min.js"></script> -->

<script src="/js/bootstrap.min.js"></script>







</body>
</html>